@* 
    Reusable Email Badge Partial View
    File: _EmailBadge.cshtml
    
    Usage:
    @await Html.PartialAsync("_EmailBadge", new EmailBadgeModel 
    { 
        Text = "New",
        BackgroundColor = "#dc3545",
        TextColor = "#ffffff"
    })
*@

@model EmailBadgeModel

@{
    var text = Model.Text ?? "Badge";
    var bgColor = Model.BackgroundColor ?? "#6c757d";
    var txtColor = Model.TextColor ?? "#ffffff";
    var height = Model.Height ?? 24;
    var radius = Model.BorderRadius ?? 12;
    var arcsize = (int)Math.Round((double)radius / height * 100);
    var fontSize = Model.FontSize ?? 12;
    var fontFamily = Model.FontFamily ?? "Arial, sans-serif";
    var fontWeight = Model.FontWeight ?? "bold";
    var paddingHorizontal = Model.PaddingHorizontal ?? 12;
    var margin = Model.Margin ?? "0";
    var display = Model.Display ?? "inline-block";
    var hasBorder = !string.IsNullOrEmpty(Model.BorderColor);
    var borderColor = Model.BorderColor ?? bgColor;
    var borderWidth = Model.BorderWidth ?? 1;
    
    // Calculate width based on text length (approximation)
    var estimatedWidth = (text.Length * (fontSize * 0.6)) + (paddingHorizontal * 2);
    var vmlWidth = (int)Math.Ceiling(estimatedWidth);
    
    // For bordered badges
    var htmlHeight = hasBorder ? height - (borderWidth * 2) : height;
}

@if (Model.Url != null)
{
    @* Clickable Badge (with link) *@
    <table cellpadding="0" cellspacing="0" border="0" style="display: @display; margin: @margin; vertical-align: middle;">
        <tr>
            <td>
                @if (hasBorder)
                {
                    @:<!--[if mso]>
                    <v:roundrect xmlns:v="urn:schemas-microsoft-com:vml" xmlns:w="urn:schemas-microsoft-com:office:word" href="@Model.Url" style="height:@(height)px;v-text-anchor:middle;width:@(vmlWidth)px;" arcsize="@(arcsize)%" strokecolor="@borderColor" strokeweight="@(borderWidth)px" fillcolor="@bgColor">
                        <w:anchorlock/>
                        <center style="color:@txtColor;font-family:@fontFamily;font-size:@(fontSize)px;font-weight:@fontWeight;">
                            @text
                        </center>
                    </v:roundrect>
                    @:<![endif]-->
                    @:<!--[if !mso]><!-->
                    <a href="@Model.Url" style="background-color: @bgColor; border: @(borderWidth)px solid @borderColor; border-radius: @(radius)px; color: @txtColor; display: inline-block; font-family: @fontFamily; font-size: @(fontSize)px; font-weight: @fontWeight; line-height: @(htmlHeight)px; text-align: center; text-decoration: none; padding: 0 @(paddingHorizontal)px; -webkit-text-size-adjust: none; mso-hide: all;">
                        @text
                    </a>
                    @:<!--<![endif]-->
                }
                else
                {
                    @:<!--[if mso]>
                    <v:roundrect xmlns:v="urn:schemas-microsoft-com:vml" xmlns:w="urn:schemas-microsoft-com:office:word" href="@Model.Url" style="height:@(height)px;v-text-anchor:middle;width:@(vmlWidth)px;" arcsize="@(arcsize)%" stroke="f" fillcolor="@bgColor">
                        <w:anchorlock/>
                        <center style="color:@txtColor;font-family:@fontFamily;font-size:@(fontSize)px;font-weight:@fontWeight;">
                            @text
                        </center>
                    </v:roundrect>
                    @:<![endif]-->
                    @:<!--[if !mso]><!-->
                    <a href="@Model.Url" style="background-color: @bgColor; border-radius: @(radius)px; color: @txtColor; display: inline-block; font-family: @fontFamily; font-size: @(fontSize)px; font-weight: @fontWeight; line-height: @(height)px; text-align: center; text-decoration: none; padding: 0 @(paddingHorizontal)px; -webkit-text-size-adjust: none; mso-hide: all;">
                        @text
                    </a>
                    @:<!--<![endif]-->
                }
            </td>
        </tr>
    </table>
}
else
{
    @* Non-clickable Badge *@
    <table cellpadding="0" cellspacing="0" border="0" style="display: @display; margin: @margin; vertical-align: middle;">
        <tr>
            <td>
                @if (hasBorder)
                {
                    @:<!--[if mso]>
                    <v:roundrect xmlns:v="urn:schemas-microsoft-com:vml" xmlns:w="urn:schemas-microsoft-com:office:word" style="height:@(height)px;v-text-anchor:middle;width:@(vmlWidth)px;" arcsize="@(arcsize)%" strokecolor="@borderColor" strokeweight="@(borderWidth)px" fillcolor="@bgColor">
                        <w:anchorlock/>
                        <center style="color:@txtColor;font-family:@fontFamily;font-size:@(fontSize)px;font-weight:@fontWeight;">
                            @text
                        </center>
                    </v:roundrect>
                    @:<![endif]-->
                    @:<!--[if !mso]><!-->
                    <span style="background-color: @bgColor; border: @(borderWidth)px solid @borderColor; border-radius: @(radius)px; color: @txtColor; display: inline-block; font-family: @fontFamily; font-size: @(fontSize)px; font-weight: @fontWeight; line-height: @(htmlHeight)px; text-align: center; padding: 0 @(paddingHorizontal)px; mso-hide: all;">
                        @text
                    </span>
                    @:<!--<![endif]-->
                }
                else
                {
                    @:<!--[if mso]>
                    <v:roundrect xmlns:v="urn:schemas-microsoft-com:vml" xmlns:w="urn:schemas-microsoft-com:office:word" style="height:@(height)px;v-text-anchor:middle;width:@(vmlWidth)px;" arcsize="@(arcsize)%" stroke="f" fillcolor="@bgColor">
                        <w:anchorlock/>
                        <center style="color:@txtColor;font-family:@fontFamily;font-size:@(fontSize)px;font-weight:@fontWeight;">
                            @text
                        </center>
                    </v:roundrect>
                    @:<![endif]-->
                    @:<!--[if !mso]><!-->
                    <span style="background-color: @bgColor; border-radius: @(radius)px; color: @txtColor; display: inline-block; font-family: @fontFamily; font-size: @(fontSize)px; font-weight: @fontWeight; line-height: @(height)px; text-align: center; padding: 0 @(paddingHorizontal)px; mso-hide: all;">
                        @text
                    </span>
                    @:<!--<![endif]-->
                }
            </td>
        </tr>
    </table>
}
